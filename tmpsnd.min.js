!function(t){t.SND=function(n){var e=this;return e.song=n,e.c=t.webkitAudioContext?new webkitAudioContext:new AudioContext,e.sends=[],e.instruments=[],n.sends.forEach(function(t){sendObj=new t[0](e.c,t[1]),sendObj.connect(e.c.destination),e.sends.push(sendObj)}),n.instruments.forEach(function(t){instrObj=new t[0](e.c,e.sends,t[1]),e.instruments.push(instrObj)}),console.log("SND.constr",this),this.p=this.p.bind(this),e},SND.extend=function(t,n){var e={};for(var i in t)e[i]=t[i];for(var a in n)e[a]=n[a];return e},SND.n2f=function(t){return 440*Math.pow(2,(t-69)/12)},SND.AD=function(t,n,e,i,a,s){t.setValueAtTime(n,i),t.linearRampToValueAtTime(e,i+a),t.setValueAtTime(e,i+a),t.linearRampToValueAtTime(n,i+s)},SND.DCA=function(t,n,e,i,a,s){var o=t.createGain();return n.connect(o),SND.AD(o.gain,0,e,i,a,s),o},SND.NoiseBuffer=function(t){var n,e;if(void 0===SND._noisebuffer){SND._noisebuffer=t.createBuffer(1,.5*t.sampleRate,22050);var i=SND._noisebuffer.getChannelData(0);for(n=0,e=i.length;e>n;n++)i[n]=2*Math.random()-1}return SND._noisebuffer},SND.sends=function(t,n,e,i){n.forEach(function(n,a){var s=t.createGain();s.gain.value=e[a]||0,i.connect(s),s.connect(n.destination)})},SND.prototype.p=function(){var t=15/this.song.cfg.tempo,n=64*t,e=0,a=this.c.currentTime;patternScheduler=function(){if(a-this.c.currentTime<n/4){var s=[];for(i=0;64>i;i++)s[i]=a+t*i;this.instruments.forEach(function(n,i){var a=this.song.playlist[e];this.song.patterns[a][i]&&n.pp(s,t,this.song.patterns[a][i])},this),e=(e+1)%this.song.playlist.length,a+=n}setTimeout(patternScheduler,40)},(patternScheduler=patternScheduler.bind(this))()},SND.DEL=function(t,n){var e=SND.extend({t:.2,fb:.4,m:.6,f:800,q:2},n);this.ac=t,this.delay=t.createDelay(),this.delay.delayTime.value=e.t;var i=t.createGain(),a=t.createBiquadFilter();return a.type="highpass",a.frequency.value=e.f,a.Q.value=e.q,i.gain.value=e.fb,this.mix=t.createGain(),this.mix.gain.value=e.m,this.delay.connect(this.mix),this.delay.connect(a),a.connect(i),i.connect(this.delay),this.connect=function(t){this.mix.connect(t)},this.connect=this.connect.bind(this),this.destination=this.delay,this},SND.SProto=function(t,n,e,i){return this.ac=t,this.sends=n,this.options=SND.extend(i,e),this.pp=this.pp.bind(this),this},SND.SProto.prototype.pp=function(t,n,e){t.forEach(function(t,i){0!=e[i]&&this.play(t,n,e[i])},this)},SND.Noise=function(t,n,e){{var i=new SND.SProto(t,n,e,{q:10,d:.05,ft:"highpass",f:8e3,v:.1,s:[]}),a=SND.NoiseBuffer(t);i.options}return i.play=function(e,s,o){var r=o[1]||{},c=SND.extend(i.options,r),u=t.createBufferSource(),f=t.createBiquadFilter();u.connect(f);var h=SND.DCA(i.ac,f,c.v,e,.001,c.d);f.frequency.value=c.f,f.type=c.ft,f.Q.value=c.q,u.buffer=a,u.connect(h),SND.sends(i.ac,n,c.s,h),h.connect(i.ac.destination),u.start(e),u.stop(e+.001+c.d)},i.play=i.play.bind(i),i},SND.Drum=function(t,n,e){var i=new SND.SProto(t,n,e,{sw:.05,d:.1,st:200,en:50,v:.8,s:[]});return i.play=function(t,e,a){var s=a[1]||{},o=SND.extend(i.options,s),r=i.ac.createOscillator();SND.AD(r.frequency,o.en,o.st,t,0,o.sw);var c=SND.DCA(i.ac,r,o.v,t,.001,o.d);c.connect(i.ac.destination),SND.sends(i.ac,n,o.s,c),r.start(t),r.stop(t+.001+o.d)},i.play=i.play.bind(i),i},SND.Synth=function(t,n,e){var i=new SND.SProto(t,n,e,{t:"sawtooth",q:10,f:200,fm:1e3,d:1,v:.5,s:[]});return i.play=function(e,a,s){var o=s[0];if("number"!=typeof o)return void o.forEach(function(t){i.play(e,a,[t,s[1]])},i);var r=s[1]||{},c=SND.extend(i.options,r),u=i.ac.createOscillator(),f=i.ac.createBiquadFilter();f.Q.value=c.q,u.frequency.value=SND.n2f(o),u.type=c.t,len=a*(r.l||1),u.connect(f);var h=SND.DCA(this.ac,f,c.v,e,.01,len);SND.sends(i.ac,n,c.s,h),h.connect(t.destination),SND.AD(f.frequency,c.f,c.f+c.fm,e,.01,len*c.d),u.start(e),u.stop(e+len)},i.play=i.play.bind(i),i}}(window);